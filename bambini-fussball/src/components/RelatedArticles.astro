---
// src/components/RelatedArticles.astro
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';

interface Props {
  category: 'trainer' | 'eltern' | 'vereine';
  currentArticleId: string;
  maxArticles?: number;
}

const { category, currentArticleId, maxArticles = 3 } = Astro.props;

// Category labels in German
const categoryLabels = {
  trainer: 'Trainer',
  eltern: 'Eltern',
  vereine: 'Vereine'
};

// Get articles from the same category
const allArticles = await getCollection(category);

// Filter out current article and sort by date (newest first)
const relatedArticles = allArticles
  .filter((article) => article.id !== currentArticleId)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, maxArticles);
---

{relatedArticles.length > 0 && (
  <aside class="related-articles mt-12 pt-8 border-t border-gray-200" aria-labelledby="related-heading">
    <h2 id="related-heading" class="text-2xl font-bold text-gray-900 mb-6">
      Weitere Artikel fur {categoryLabels[category]}
    </h2>
    <div class="grid gap-4 md:grid-cols-3">
      {relatedArticles.map((article) => (
        <article class="bg-gray-50 border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition-shadow">
          {article.data.image && (
            <Image
              src={article.data.image}
              alt={article.data.imageAlt || article.data.title}
              width={300}
              height={169}
              class="w-full h-32 object-cover"
            />
          )}
          <div class="p-4">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">
              <a href={`/${category}/${article.id}/`} class="hover:text-green-700">
                {article.data.title}
              </a>
            </h3>
            <p class="text-sm text-gray-600 line-clamp-2">{article.data.description}</p>
          </div>
        </article>
      ))}
    </div>
  </aside>
)}

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
