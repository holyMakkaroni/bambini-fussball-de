---
phase: 05-seo-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/layouts/BaseLayout.astro
  - src/content.config.ts
autonomous: true

must_haves:
  truths:
    - "Every page has a canonical URL in head"
    - "Every page has Open Graph meta tags for social sharing"
    - "Article frontmatter validates title < 60 chars and description < 160 chars"
  artifacts:
    - path: "src/layouts/BaseLayout.astro"
      provides: "Enhanced head with canonical, OG tags, head slot"
      contains: "og:title"
    - path: "src/content.config.ts"
      provides: "Validated article schema with length constraints"
      contains: "max(60)"
  key_links:
    - from: "src/layouts/BaseLayout.astro"
      to: "Astro.url"
      via: "canonical URL construction"
      pattern: "rel=\"canonical\""
---

<objective>
Enhance meta tag system with canonical URLs, Open Graph tags, and schema validation

Purpose: Meet SEO-01 (unique meta title < 60 chars) and SEO-02 (unique meta description < 160 chars) requirements, plus social sharing readiness
Output: BaseLayout with full SEO head, validated content schema
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-seo-infrastructure/05-RESEARCH.md

@bambini-fussball/src/layouts/BaseLayout.astro
@bambini-fussball/src/content.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance BaseLayout with canonical and Open Graph tags</name>
  <files>bambini-fussball/src/layouts/BaseLayout.astro</files>
  <action>
Update BaseLayout.astro to include:

1. Extended Props interface:
```typescript
interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: 'website' | 'article';
}
```

2. Construct canonical URL using Astro.url:
```typescript
const canonicalURL = new URL(Astro.url.pathname, 'https://bambini-fussball.pages.dev');
const socialImageURL = new URL(image || '/images/og-default.jpg', 'https://bambini-fussball.pages.dev');
```

3. Add to head section (after existing meta tags, before title):
- `<link rel="canonical" href={canonicalURL} />`
- Open Graph tags:
  - `<meta property="og:type" content={type || 'website'} />`
  - `<meta property="og:url" content={canonicalURL} />`
  - `<meta property="og:title" content={title} />`
  - `<meta property="og:description" content={description} />`
  - `<meta property="og:image" content={socialImageURL} />`
  - `<meta property="og:locale" content="de_DE" />`
  - `<meta property="og:site_name" content="Bambini-Fussball" />`
- Twitter card fallback: `<meta name="twitter:card" content="summary_large_image" />`

4. Add head slot for page-specific head content:
```astro
<slot name="head" />
```
Place this after the twitter:card meta tag, before closing </head>.

Keep all existing content (Header, Footer, body structure) unchanged.
  </action>
  <verify>Run `npm run build` in bambini-fussball directory - should succeed with no errors</verify>
  <done>BaseLayout head contains canonical link, all OG meta tags, twitter:card, and head slot</done>
</task>

<task type="auto">
  <name>Task 2: Add validation constraints to article schema</name>
  <files>bambini-fussball/src/content.config.ts</files>
  <action>
Update articleSchema in content.config.ts to add length validation:

```typescript
const articleSchema = z.object({
  title: z.string().max(60, 'Title must be 60 characters or less'),
  description: z.string().max(160, 'Description must be 160 characters or less'),
  pubDate: z.coerce.date(),
  updatedDate: z.coerce.date().optional(),
  author: z.string().default('Redaktion'),
  image: z.string().optional(),
});
```

Changes:
1. Add `.max(60, 'Title must be 60 characters or less')` to title
2. Add `.max(160, 'Description must be 160 characters or less')` to description
3. Add `image: z.string().optional()` field for article images

Keep all collection definitions unchanged (trainer, eltern, vereine using articleSchema).
  </action>
  <verify>Run `npm run build` in bambini-fussball directory - should succeed. The existing beispiel-artikel.md has title ~55 chars and description ~110 chars, so it will pass validation.</verify>
  <done>Article schema validates title max 60 chars, description max 160 chars, and accepts optional image field</done>
</task>

</tasks>

<verification>
After completing both tasks:

1. Build succeeds: `npm run build` completes without errors
2. View page source of built output:
   - `dist/index.html` contains `<link rel="canonical"`
   - `dist/index.html` contains `<meta property="og:title"`
   - `dist/index.html` contains `<meta property="og:locale" content="de_DE"`
3. Existing content still works:
   - `dist/trainer/beispiel-artikel/index.html` exists and renders
</verification>

<success_criteria>
- BaseLayout.astro has canonical URL, Open Graph tags, twitter:card, head slot
- content.config.ts validates title < 60 and description < 160
- Site builds successfully with no validation errors
- All existing pages render correctly
</success_criteria>

<output>
After completion, create `.planning/phases/05-seo-infrastructure/05-01-SUMMARY.md`
</output>
