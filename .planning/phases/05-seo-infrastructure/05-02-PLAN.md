---
phase: 05-seo-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/content.config.ts
  - src/content/authors/redaktion.json
  - src/layouts/ArticleLayout.astro
  - src/pages/trainer/[id].astro
  - src/pages/eltern/[id].astro
  - src/pages/vereine/[id].astro
  - src/content/trainer/beispiel-artikel.md
autonomous: true

must_haves:
  truths:
    - "Article pages include Article JSON-LD schema in page source"
    - "Author entity in Article schema has @id linking to author profile URL"
    - "Author collection exists with at least one author (redaktion)"
  artifacts:
    - path: "src/content/authors/redaktion.json"
      provides: "Default author profile data"
      contains: "Redaktion"
    - path: "src/layouts/ArticleLayout.astro"
      provides: "Article JSON-LD schema output"
      contains: "application/ld+json"
    - path: "src/content.config.ts"
      provides: "Authors collection with reference() support"
      contains: "reference('authors')"
  key_links:
    - from: "src/layouts/ArticleLayout.astro"
      to: "JSON-LD script tag"
      via: "set:html={JSON.stringify(articleSchema)}"
      pattern: "type=\"application/ld\\+json\""
    - from: "src/pages/trainer/[id].astro"
      to: "src/content/authors/"
      via: "getEntry(article.data.author)"
      pattern: "getEntry"
---

<objective>
Create author collection with reference() and add Article JSON-LD schema to article pages

Purpose: Meet SEO-03 (Article JSON-LD) and SEO-04 (Author schema linked) requirements
Output: Authors collection, ArticleLayout with JSON-LD, updated dynamic routes
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-seo-infrastructure/05-RESEARCH.md
@.planning/phases/05-seo-infrastructure/05-01-SUMMARY.md

@bambini-fussball/src/content.config.ts
@bambini-fussball/src/layouts/ArticleLayout.astro
@bambini-fussball/src/pages/trainer/[id].astro
@bambini-fussball/src/content/trainer/beispiel-artikel.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create authors collection and update content config</name>
  <files>
    bambini-fussball/src/content/authors/redaktion.json
    bambini-fussball/src/content.config.ts
  </files>
  <action>
1. Create directory `bambini-fussball/src/content/authors/`

2. Create `bambini-fussball/src/content/authors/redaktion.json`:
```json
{
  "name": "Redaktion",
  "bio": "Die Redaktion von Bambini-Fussball.de besteht aus erfahrenen Trainern und Padagogen mit langjahrigem Hintergrund im Kinderfussball.",
  "credentials": "DFB-Lizenztrainer, Sportpadagogen",
  "image": "/images/authors/redaktion.jpg",
  "sameAs": []
}
```

3. Update `bambini-fussball/src/content.config.ts`:
- Add `reference` to imports from 'astro:content'
- Add authors collection:
```typescript
const authors = defineCollection({
  loader: glob({ pattern: '**/*.json', base: './src/content/authors' }),
  schema: z.object({
    name: z.string(),
    bio: z.string().max(300),
    credentials: z.string(),
    image: z.string(),
    sameAs: z.array(z.string().url()).optional().default([])
  })
});
```
- Update articleSchema to use reference instead of string for author field:
```typescript
const articleSchema = z.object({
  title: z.string().max(60, 'Title must be 60 characters or less'),
  description: z.string().max(160, 'Description must be 160 characters or less'),
  pubDate: z.coerce.date(),
  updatedDate: z.coerce.date().optional(),
  author: reference('authors'),
  image: z.string().optional(),
});
```
NOTE: The max() validations and image field were added by Plan 05-01. This task only changes `author: z.string().default('Redaktion')` to `author: reference('authors')`.

- Export authors in collections: `export const collections = { authors, trainer, eltern, vereine };`

4. Update `bambini-fussball/src/content/trainer/beispiel-artikel.md` frontmatter:
Change `author: "Redaktion"` to `author: redaktion` (no quotes - it's a reference to authors/redaktion.json)
  </action>
  <verify>Run `npm run build` in bambini-fussball directory - should succeed with content validation passing</verify>
  <done>Authors collection exists with redaktion.json, articleSchema uses reference('authors'), existing article updated to use reference</done>
</task>

<task type="auto">
  <name>Task 2: Add Article JSON-LD to ArticleLayout and update dynamic routes</name>
  <files>
    bambini-fussball/src/layouts/ArticleLayout.astro
    bambini-fussball/src/pages/trainer/[id].astro
    bambini-fussball/src/pages/eltern/[id].astro
    bambini-fussball/src/pages/vereine/[id].astro
  </files>
  <action>
1. Update ArticleLayout.astro Props interface to receive author data:
```typescript
interface Props {
  title: string;
  description: string;
  category: 'trainer' | 'eltern' | 'vereine';
  pubDate: Date;
  updatedDate?: Date;
  authorId: string;
  authorName: string;
  image?: string;
}
```

2. Destructure new props:
```typescript
const { title, description, category, pubDate, updatedDate, authorId, authorName, image } = Astro.props;
```

3. Add Article JSON-LD schema construction after breadcrumbs definition:
```typescript
const siteUrl = 'https://bambini-fussball.pages.dev';
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "image": image ? `${siteUrl}${image}` : `${siteUrl}/images/og-default.jpg`,
  "datePublished": pubDate.toISOString(),
  "dateModified": (updatedDate || pubDate).toISOString(),
  "author": {
    "@type": "Person",
    "@id": `${siteUrl}/autor/${authorId}/`,
    "name": authorName,
    "url": `${siteUrl}/autor/${authorId}/`
  },
  "publisher": {
    "@type": "Organization",
    "name": "Bambini-Fussball",
    "url": siteUrl
  }
};
```

4. Pass type="article" and image to BaseLayout:
```astro
<BaseLayout title={`${title} | Bambini-Fussball`} description={description} type="article" image={image}>
```

5. Add JSON-LD script in head slot:
```astro
<script slot="head" type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
```
Place this immediately after the opening BaseLayout tag.

6. Update author display in article header from:
```astro
<span>Von {author}</span>
```
to:
```astro
<span>Von <a href={`/autor/${authorId}/`} class="text-green-700 hover:underline">{authorName}</a></span>
```

7. Update all three dynamic route files (trainer/[id].astro, eltern/[id].astro, vereine/[id].astro):
- Add getEntry import: `import { getCollection, getEntry, render } from 'astro:content';`
- After getting article props, resolve author reference:
```typescript
const { article } = Astro.props;
const author = await getEntry(article.data.author);
const { Content } = await render(article);
```
- Update ArticleLayout props:
```astro
<ArticleLayout
  title={article.data.title}
  description={article.data.description}
  category="trainer"
  pubDate={article.data.pubDate}
  updatedDate={article.data.updatedDate}
  authorId={author.id}
  authorName={author.data.name}
  image={article.data.image}
>
```
(Adjust category for each file: "trainer", "eltern", "vereine")
  </action>
  <verify>
1. Run `npm run build` - should succeed
2. Check `dist/trainer/beispiel-artikel/index.html` contains:
   - `<script type="application/ld+json"` with Article schema
   - `@type": "Article"`
   - `author` object with `@id` containing `/autor/redaktion/`
  </verify>
  <done>ArticleLayout outputs Article JSON-LD with linked author entity, all dynamic routes resolve author reference</done>
</task>

</tasks>

<verification>
After completing both tasks:

1. Build succeeds: `npm run build` completes without errors
2. View source of `dist/trainer/beispiel-artikel/index.html`:
   - Contains `<script type="application/ld+json">`
   - JSON contains `"@type": "Article"`
   - JSON contains `"author": { "@type": "Person", "@id": "https://bambini-fussball.pages.dev/autor/redaktion/"...`
3. Author link in article header points to /autor/redaktion/
4. Content still renders correctly with article body visible
</verification>

<success_criteria>
- Authors collection exists with redaktion.json
- Article schema uses reference('authors') not string
- ArticleLayout outputs Article JSON-LD in head
- Author @id matches pattern: https://bambini-fussball.pages.dev/autor/{id}/
- All three category routes resolve author and pass data to layout
- Site builds successfully
</success_criteria>

<output>
After completion, create `.planning/phases/05-seo-infrastructure/05-02-SUMMARY.md`
</output>
