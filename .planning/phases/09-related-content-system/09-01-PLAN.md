---
phase: 09-related-content-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/RelatedArticles.astro
  - src/layouts/ArticleLayout.astro
  - src/pages/trainer/[id].astro
  - src/pages/eltern/[id].astro
  - src/pages/vereine/[id].astro
autonomous: true

must_haves:
  truths:
    - "Related articles section appears at bottom of every article"
    - "Each article shows 3-4 contextually relevant links from same category"
    - "Related articles display title and description"
    - "Links lead to actual articles (not broken)"
    - "Current article does not appear in its own related articles"
    - "Section handles gracefully when category has few articles"
  artifacts:
    - path: "src/components/RelatedArticles.astro"
      provides: "Related articles component with category filtering"
      exports: ["default"]
      min_lines: 40
    - path: "src/layouts/ArticleLayout.astro"
      provides: "Article layout with RelatedArticles integration"
      contains: "RelatedArticles"
  key_links:
    - from: "src/layouts/ArticleLayout.astro"
      to: "src/components/RelatedArticles.astro"
      via: "import and component usage"
      pattern: "import RelatedArticles"
    - from: "src/components/RelatedArticles.astro"
      to: "astro:content"
      via: "getCollection query"
      pattern: "getCollection\\(category\\)"
    - from: "src/pages/trainer/[id].astro"
      to: "src/layouts/ArticleLayout.astro"
      via: "articleId prop"
      pattern: "articleId=\\{article\\.id\\}"
---

<objective>
Implement a related articles system that displays 3-4 contextually relevant article links at the bottom of every article, using same-category filtering to enable content discovery across the site's 28 articles.

Purpose: Enable readers to discover more content within their interest area (Trainer, Eltern, or Vereine), improving engagement and time on site.

Output: RelatedArticles.astro component integrated into all article pages via ArticleLayout.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-related-content-system/09-RESEARCH.md

# Existing files to modify
@bambini-fussball/src/layouts/ArticleLayout.astro
@bambini-fussball/src/pages/trainer/[id].astro
@bambini-fussball/src/pages/eltern/[id].astro
@bambini-fussball/src/pages/vereine/[id].astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RelatedArticles.astro component</name>
  <files>bambini-fussball/src/components/RelatedArticles.astro</files>
  <action>
Create the RelatedArticles.astro component that:

1. Accepts props: category ('trainer' | 'eltern' | 'vereine'), currentArticleId (string), limit (number, default 4)

2. Uses getCollection(category) to query articles from the same category

3. Filters out the current article using `.filter(article => article.id !== currentArticleId)`

4. Sorts by pubDate descending (newest first)

5. Slices to limit (default 4)

6. Renders only if relatedArticles.length > 0 (empty state handling)

7. Displays as an aside section with:
   - Heading: "Weitere Artikel fur {categoryLabel}" using German category labels
   - Grid layout: 2 columns on sm+, 1 column on mobile
   - Each link shows title (font-semibold) and description (text-sm, line-clamp-2)
   - Hover states matching site design (green-700 text, shadow)
   - Border-t separator from main article content

Use the exact code pattern from 09-RESEARCH.md "Complete RelatedArticles Component" section, with styling:
- mt-12 pt-8 border-t border-gray-200 for section spacing
- text-2xl font-bold text-gray-900 mb-6 for heading
- grid gap-4 sm:grid-cols-2 for layout
- block p-4 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-shadow for cards
  </action>
  <verify>File exists at bambini-fussball/src/components/RelatedArticles.astro with proper TypeScript interface, getCollection import, and conditional rendering</verify>
  <done>RelatedArticles component created with category filtering, date sorting, and responsive grid layout</done>
</task>

<task type="auto">
  <name>Task 2: Integrate RelatedArticles into ArticleLayout</name>
  <files>bambini-fussball/src/layouts/ArticleLayout.astro</files>
  <action>
Modify ArticleLayout.astro to:

1. Add articleId to the Props interface:
   ```typescript
   interface Props {
     title: string;
     description: string;
     category: 'trainer' | 'eltern' | 'vereine';
     articleId: string;  // NEW
     pubDate: Date;
     updatedDate?: Date;
     authorId: string;
     authorName: string;
     image?: string;
   }
   ```

2. Destructure articleId from Astro.props

3. Import RelatedArticles component at top:
   ```typescript
   import RelatedArticles from '../components/RelatedArticles.astro';
   ```

4. Add RelatedArticles component AFTER the closing article tag but INSIDE main:
   ```astro
   </article>

   <RelatedArticles
     category={category}
     currentArticleId={articleId}
   />
   </main>
   ```

The component goes inside main but outside the article prose section for proper semantic structure (aside content).
  </action>
  <verify>ArticleLayout.astro includes RelatedArticles import, articleId in Props interface, and component placement after article</verify>
  <done>ArticleLayout passes articleId to RelatedArticles component which renders after article content</done>
</task>

<task type="auto">
  <name>Task 3: Pass articleId from all [id].astro pages</name>
  <files>
    bambini-fussball/src/pages/trainer/[id].astro
    bambini-fussball/src/pages/eltern/[id].astro
    bambini-fussball/src/pages/vereine/[id].astro
  </files>
  <action>
Modify each of the three [id].astro files to pass articleId to ArticleLayout:

For trainer/[id].astro, eltern/[id].astro, and vereine/[id].astro, add the articleId prop to ArticleLayout:

```astro
<ArticleLayout
  title={article.data.title}
  description={article.data.description}
  category="trainer"  <!-- or "eltern" or "vereine" -->
  articleId={article.id}   <!-- ADD THIS LINE -->
  pubDate={article.data.pubDate}
  updatedDate={article.data.updatedDate}
  authorId={author.id}
  authorName={author.data.name}
  image={article.data.image}
>
  <Content />
</ArticleLayout>
```

The article object already has .id property (used in getStaticPaths), so no additional imports or queries needed.
  </action>
  <verify>All three [id].astro files include articleId={article.id} prop in ArticleLayout component</verify>
  <done>All article pages pass articleId to layout, enabling RelatedArticles to exclude current article</done>
</task>

</tasks>

<verification>
Run the following to verify the implementation:

1. Build check:
   ```bash
   cd bambini-fussball && npm run build
   ```
   Should complete without errors.

2. Manual verification (dev server):
   ```bash
   cd bambini-fussball && npm run dev
   ```
   - Visit http://localhost:4321/trainer/bambini-training-erste-schritte/
   - Scroll to bottom of article
   - Verify "Weitere Artikel fur Trainer" section appears
   - Verify 3-4 related articles shown (excluding current article)
   - Verify links work and lead to other trainer articles
   - Repeat for one eltern and one vereine article

3. Edge case verification:
   - Check that current article does NOT appear in its own related list
   - Check responsive layout (2 columns on desktop, 1 on mobile)
</verification>

<success_criteria>
Phase 9 is complete when:
1. RelatedArticles.astro component exists and compiles
2. All articles display related articles section at bottom
3. Related articles are from same category only
4. Current article never appears in its own related list
5. Links work and navigate to correct articles
6. Section does not render if category has 0 other articles
7. Build completes successfully
</success_criteria>

<output>
After completion, create `.planning/phases/09-related-content-system/09-01-SUMMARY.md`
</output>
